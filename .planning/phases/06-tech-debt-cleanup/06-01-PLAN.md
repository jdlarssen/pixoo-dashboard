---
phase: 06-tech-debt-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/config.py
  - src/main.py
  - tests/test_weather_anim.py
  - tests/test_fonts.py
  - pyproject.toml
autonomous: true
requirements: []

must_haves:
  truths:
    - "No dead constants remain in config.py (FONT_LARGE and PUSH_INTERVAL removed)"
    - "main_loop() docstring accurately reflects the current font dictionary keys (small, tiny)"
    - "No Pillow deprecation warnings from getdata() in the test suite"
    - "All 96+ existing tests still pass after changes"
    - "pyproject.toml pins Pillow>=12.1.0 as a version floor"
  artifacts:
    - path: "src/config.py"
      provides: "Clean config with only active constants"
      contains: "FONT_SMALL"
    - path: "src/main.py"
      provides: "Accurate main_loop docstring"
      contains: '"small", "tiny"'
    - path: "tests/test_weather_anim.py"
      provides: "Deprecation-free weather animation tests"
      contains: "get_flattened_data"
    - path: "tests/test_fonts.py"
      provides: "Deprecation-free font tests"
      contains: "get_flattened_data"
  key_links:
    - from: "src/main.py"
      to: "src/config.py"
      via: "import FONT_SMALL, FONT_TINY (not FONT_LARGE, not PUSH_INTERVAL)"
      pattern: "from src.config import.*FONT_SMALL.*FONT_TINY"
---

<objective>
Remove dead code, fix stale docstrings, and remediate Pillow deprecation warnings across the codebase.

Purpose: Eliminate tech debt identified in the v1.0 milestone audit -- dead constants that confuse readers, a stale docstring that references removed code, and a deprecated Pillow API call that will break in a future version.

Output: Clean config.py, accurate main.py docstring, deprecation-free test files, and a Pillow version floor pin.
</objective>

<execution_context>
@/Users/jdl/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jdl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-tech-debt-cleanup/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove dead constants and fix stale docstrings</name>
  <files>src/config.py, src/main.py</files>
  <action>
In src/config.py:
1. Remove the line `PUSH_INTERVAL = 1  # seconds between state checks` (line 12). Also remove the blank line that follows it if it leaves a double-blank.
2. Remove the line `FONT_LARGE = "7x13"   # for clock digits` (line 16). Keep FONT_SMALL and FONT_TINY.

In src/main.py:
1. Fix the main_loop() docstring on line 88. Change:
   `fonts: Font dictionary with keys "large", "small", "tiny".`
   to:
   `fonts: Font dictionary with keys "small", "tiny".`

Verify no other file imports FONT_LARGE or PUSH_INTERVAL before removing:
```bash
grep -r "FONT_LARGE\|PUSH_INTERVAL" src/ tests/ --include="*.py" | grep -v "config.py"
```
Should return zero results.

These are semantic no-ops -- no runtime behavior changes.
  </action>
  <verify>
```bash
# Verify dead constants are gone
grep -c "FONT_LARGE\|PUSH_INTERVAL" src/config.py
# Should return 0

# Verify docstring is fixed
grep '"large"' src/main.py
# Should return no results

# Run full test suite
python -m pytest tests/ -q
# All tests pass
```
  </verify>
  <done>FONT_LARGE and PUSH_INTERVAL no longer exist in config.py. main_loop() docstring says "small", "tiny" without "large". All tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Replace deprecated Pillow getdata() calls and pin version</name>
  <files>tests/test_weather_anim.py, tests/test_fonts.py, pyproject.toml</files>
  <action>
In tests/test_weather_anim.py, replace all `getdata()` calls with `get_flattened_data()`:
1. Line 29: `max(alpha_band.getdata())` → `max(alpha_band.get_flattened_data())`
2. Line 38: `alpha_band.getdata()` → `alpha_band.get_flattened_data()`

In tests/test_fonts.py, replace:
1. Line 53: `list(img.getdata())` → `list(img.get_flattened_data())`

In pyproject.toml, add a version floor to the Pillow dependency:
- Change `"Pillow"` to `"Pillow>=12.1.0"` in the dependencies list.
- This prevents breakage if someone recreates the environment with an older Pillow that lacks `get_flattened_data()`.

Do NOT change any production code in src/ -- there are zero getdata() calls there.
  </action>
  <verify>
```bash
# Verify no getdata() calls remain
grep -r "\.getdata()" tests/ --include="*.py"
# Should return no results

# Verify get_flattened_data is used
grep -r "get_flattened_data" tests/ --include="*.py"
# Should show 3 occurrences

# Verify pyproject.toml has version floor
grep "Pillow" pyproject.toml
# Should show "Pillow>=12.1.0"

# Run full test suite
python -m pytest tests/ -q
# All tests pass

# Run ruff lint
ruff check src/ tests/
# No errors
```
  </verify>
  <done>All 3 getdata() calls replaced with get_flattened_data(). pyproject.toml pins Pillow>=12.1.0. Full test suite passes. No lint errors.</done>
</task>

</tasks>

<verification>
1. `grep -r "FONT_LARGE\|PUSH_INTERVAL" src/ tests/ --include="*.py"` returns zero results
2. `grep -r "\.getdata()" src/ tests/ --include="*.py"` returns zero results
3. `python -m pytest tests/ -q` passes all tests with zero failures
4. `ruff check src/ tests/` reports no errors
5. `grep "Pillow" pyproject.toml` shows `Pillow>=12.1.0`
</verification>

<success_criteria>
- Zero dead constants in config.py (FONT_LARGE and PUSH_INTERVAL removed)
- main_loop() docstring references only "small" and "tiny" font keys
- Zero Pillow getdata() deprecation calls remain in test files
- pyproject.toml has Pillow>=12.1.0 version floor
- Full test suite passes (96+ tests)
- No ruff lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-tech-debt-cleanup/06-01-SUMMARY.md`
</output>
